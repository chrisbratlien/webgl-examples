<!DOCTYPE html>
<html>
<body>

<img id="scream" src="img_the_scream.jpg" alt="The Scream" width="220" height="277">
<canvas id="myCanvas" width="220" height="277" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>
<script type="module">
  //import scalar, {lerp} from './scalar.js';
  import scalar, {lerp, remap, invlerp} from './scalar.js';
  window.lerp = lerp;
  window.invlerp = invlerp;
  window.remap = remap;
  window.scalar = scalar;
  //window.scalar = scalar;
</script>

<script>
function toXY(i,w,h) {
  let x = i % w;
  let y = Math.floor(i / w);
  return [x,y];
}

function transformColor(x,y,r,g,b,a,uniform) {
    let v_x =  remap(0,uniform.width,0,255,x);
    let v_y =  remap(0,uniform.height,0,255,y);

    r = v_x;

  return [r,g,b,a];
}

function process() {
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");
  var img = document.getElementById("scream");
  ctx.drawImage(img, 0, 0);
  var imgData = ctx.getImageData(0, 0, c.width, c.height);
  console.log(c.width,c.height);
  // invert colors
  var i,pixelIdx = 0;
  for (i = 0; i < imgData.data.length; i += 4) {
    let pixelIdx = Math.floor(i / 4);
    let [x,y] = toXY(pixelIdx, c.width, c.height);
    //let t = lerp()
    //scalar.remap(0,277,0,1,276)
    let t_x = invlerp(0,c.width,x);
    let t_y = invlerp(0,c.height,y);
    let v_x =  remap(0,c.width,0,255,x);
    let v_y =  remap(0,c.height,0,255,y);
    //console.log('i',i,'pixelIdx',pixelIdx,'x',x,'y',y,'t_x',t_x,'v_x',v_x);

    let [r,g,b,a] = transformColor(
      x,
      y,
      imgData.data[i+0],
      imgData.data[i+1],
      imgData.data[i+2],
      imgData.data[i+3],
      {
        width: c.width,
        height: c.height
      }
    );

    imgData.data[i+0] = r;
    imgData.data[i+1] = g;
    imgData.data[i+2] = b;
    imgData.data[i+3] = a;



    /**
    imgData.data[i+0] = v_x;
    imgData.data[i+1] = v_x;
    imgData.data[i+2] = v_y;
    imgData.data[i+3] = 255;
    ***/
    /**
    imgData.data[i] = 255 - imgData.data[i]; //r
    imgData.data[i+1] = 255 - imgData.data[i+1]; //g
    imgData.data[i+2] = 255 - imgData.data[i+2]; //b
    imgData.data[i+3] = 255; //a
    ***/
    pixelIdx += 1;
  }
  ctx.putImageData(imgData, 0, 0);
}

setTimeout(process,1000);

</script>

</body>
</html>

